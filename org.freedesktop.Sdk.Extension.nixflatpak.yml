id: org.freedesktop.Sdk.Extension.nixflatpak
branch: '23.08'
runtime: org.freedesktop.Sdk
runtime-version: '23.08'
build-extension: true
sdk: org.freedesktop.Sdk
sdk-extensions:
- org.freedesktop.Sdk.Extension.rust-stable
- org.freedesktop.Sdk.Extension.llvm16

appstream-compose: false
separate-locales: false

build-options:
  append-path: /usr/lib/sdk/rust-stable/bin:/usr/lib/sdk/llvm16/bin
  env:
    CARGO_TARGET_X86_64_UNKNOWN_LINUX_GNU_LINKER: "clang"
    CARGO_TARGET_X86_64_UNKNOWN_LINUX_GNU_RUSTFLAGS: "-C link-arg=-fuse-ld=/usr/lib/sdk/rust-stable/bin/mold"
    CARGO_TARGET_AARCH64_UNKNOWN_LINUX_GNU_LINKER: "clang"
    CARGO_TARGET_AARCH64_UNKNOWN_LINUX_GNU_RUSTFLAGS: "-C link-arg=-fuse-ld=/usr/lib/sdk/rust-stable/bin/mold"
  prefix: /app/extension_directory/nixflatpak
  prepend-path: /app/extension_directory/nixflatpak/bin

modules:

   - name: nix-flatpak
     buildsystem: simple
      - cargo --offline fetch --manifest-path Cargo.toml --verbose
      - cargo --offline build --release --verbose
      - install -Dm755 ./target/release/app -t /app/extension_directory/nix-flatpak
     sources:
      - type: dir
        path: app/
      - app/generated-sources.json
